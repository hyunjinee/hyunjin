{"version":3,"sources":["../../src/queryClient.ts"],"sourcesContent":["import { QueryCache } from './queryCache';\nimport {\n  DefaultedQueryObserverOptions,\n  DefaultError,\n  DefaultOptions,\n  FetchQueryOptions,\n  OmitKeyof,\n  QueryClientConfig,\n  QueryKey,\n  QueryObserverOptions,\n  QueryOptions,\n} from './types';\nimport { partialMatchKey } from './utils';\n\n// TYPES\n\ninterface QueryDefaults {\n  queryKey: QueryKey;\n  defaultOptions: OmitKeyof<QueryOptions<any, any, any>, 'queryKey'>;\n}\n\ninterface MutationDefaults {\n  // mutationKey: MutationKey;\n  // defaultOptions: MutationOptions<any, any, any, any>;\n}\n\nexport class QueryClient {\n  #queryCache: QueryCache;\n\n  #defaultOptions: DefaultOptions;\n  #queryDefaults: Map<string, QueryDefaults>;\n  #mutationDefaults: Map<string, MutationDefaults>;\n  #mountCount: number;\n  #unsubscribeFocus?: () => void;\n  #unsubscribeOnline?: () => void;\n\n  constructor(config: QueryClientConfig = {}) {\n    this.#queryCache = config.queryCache || new QueryCache();\n\n    this.#defaultOptions = config.defaultOptions || {};\n\n    this.#queryDefaults = new Map();\n    this.#mutationDefaults = new Map();\n    this.#mountCount = 0;\n  }\n\n  mount() {\n    this.#mountCount++;\n\n    if (this.#mountCount !== 1) {\n      return;\n    }\n  }\n\n  unmount() {\n    this.#mountCount--;\n\n    if (this.#mountCount !== 0) {\n      return;\n    }\n  }\n\n  isFetching() {}\n\n  getQueryData<TQueryFnData = unknown, TTaggedQueryKey extends QueryKey = QueryKey>() {}\n\n  getQueryDefaults(queryKey: QueryKey) {\n    const defaults = [...this.#queryDefaults.values()];\n\n    let result: OmitKeyof<QueryObserverOptions<any, any, any, any, any>, 'queryKey'> = {};\n\n    defaults.forEach((queryDefault) => {\n      if (partialMatchKey(queryKey, queryDefault.queryKey)) {\n        result = { ...result, ...queryDefault.defaultOptions };\n      }\n    });\n    return result;\n  }\n\n  defaultQueryOptions<\n    TQueryFnData = unknown,\n    TError = DefaultError,\n    TData = TQueryFnData,\n    TQueryData = TQueryFnData,\n    TQueryKey extends QueryKey = QueryKey,\n    TPageParam = never,\n  >(\n    options:\n      | QueryObserverOptions<TQueryFnData, TError, TData, TQueryData, TQueryKey, TPageParam>\n      | DefaultedQueryObserverOptions<TQueryFnData, TError, TData, TQueryData, TQueryKey>,\n  ): DefaultedQueryObserverOptions<TQueryFnData, TError, TData, TQueryData, TQueryKey> {\n    if (options._defaulted) {\n      return options as DefaultedQueryObserverOptions<TQueryFnData, TError, TData, TQueryData, TQueryKey>;\n    }\n\n    const defaultedOptions = {\n      ...this.#defaultOptions.queries,\n\n      _defaulted: true,\n    };\n\n    return defaultedOptions as DefaultedQueryObserverOptions<TQueryFnData, TError, TData, TQueryData, TQueryKey>;\n  }\n\n  fetchQuery<TQueryFnData, TData = TQueryFnData, TQueryKey extends QueryKey = QueryKey, TPageParam = never>(\n    options: FetchQueryOptions<TQueryFnData, TError, TData, TQueryKey, TPageParam>,\n  ) {}\n\n  getQueryCache(): QueryCache {\n    return this.#queryCache;\n  }\n\n  getDefaultOptions(): DefaultOptions {\n    return this.#defaultOptions;\n  }\n\n  clear() {}\n}\n"],"mappings":";AAAA,SAAS,kBAAkB;AAY3B,SAAS,uBAAuB;AAczB,IAAM,cAAN,MAAkB;AAAA,EACvB;AAAA,EAEA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EACA;AAAA,EAEA,YAAY,SAA4B,CAAC,GAAG;AAC1C,SAAK,cAAc,OAAO,cAAc,IAAI,WAAW;AAEvD,SAAK,kBAAkB,OAAO,kBAAkB,CAAC;AAEjD,SAAK,iBAAiB,oBAAI,IAAI;AAC9B,SAAK,oBAAoB,oBAAI,IAAI;AACjC,SAAK,cAAc;AAAA,EACrB;AAAA,EAEA,QAAQ;AACN,SAAK;AAEL,QAAI,KAAK,gBAAgB,GAAG;AAC1B;AAAA,IACF;AAAA,EACF;AAAA,EAEA,UAAU;AACR,SAAK;AAEL,QAAI,KAAK,gBAAgB,GAAG;AAC1B;AAAA,IACF;AAAA,EACF;AAAA,EAEA,aAAa;AAAA,EAAC;AAAA,EAEd,eAAoF;AAAA,EAAC;AAAA,EAErF,iBAAiB,UAAoB;AACnC,UAAM,WAAW,CAAC,GAAG,KAAK,eAAe,OAAO,CAAC;AAEjD,QAAI,SAA+E,CAAC;AAEpF,aAAS,QAAQ,CAAC,iBAAiB;AACjC,UAAI,gBAAgB,UAAU,aAAa,QAAQ,GAAG;AACpD,iBAAS,EAAE,GAAG,QAAQ,GAAG,aAAa,eAAe;AAAA,MACvD;AAAA,IACF,CAAC;AACD,WAAO;AAAA,EACT;AAAA,EAEA,oBAQE,SAGmF;AACnF,QAAI,QAAQ,YAAY;AACtB,aAAO;AAAA,IACT;AAEA,UAAM,mBAAmB;AAAA,MACvB,GAAG,KAAK,gBAAgB;AAAA,MAExB,YAAY;AAAA,IACd;AAEA,WAAO;AAAA,EACT;AAAA,EAEA,WACE,SACA;AAAA,EAAC;AAAA,EAEH,gBAA4B;AAC1B,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,oBAAoC;AAClC,WAAO,KAAK;AAAA,EACd;AAAA,EAEA,QAAQ;AAAA,EAAC;AACX;","names":[]}